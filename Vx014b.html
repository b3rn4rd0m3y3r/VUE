<!DOCTYPE html>
<html>
<head>
  <title>Vx014b</title>
  <meta charset="iso-8859-1">
  <style>
	#app {
		display: inline-block;
		font-family: Heebo;
		padding: 14px;
		}
	.fte16 {font-size: 20px;}
	.fte18 {font-size: 24px;}
	.vd {color: green;  }
	.mr {color: maroon;  }
	.neg { font-weight: bold; }
	H1 { color: crimson; }
	
  </style>
  <script src="vue334.js"></script>
  <script>
	var prods = [];
	var vm = "";
	const app = Vue.createApp({
		data() {
			return {
				cod: '',
				descri: '',
				preco: '',
				produtos: prods
				}
			},
		methods: {
			loadReg(){
				fetch("./test.json")
					.then(response => response.json())
					.then(data => (this.produtos = data));
				console.log(this.produtos);				
				},
			saveReg(){
				const data = JSON.stringify(this.produtos);
				const blob = new Blob([data], {type: 'text/json'});
				const e = document.createEvent('MouseEvents'),
				a = document.createElement('a');
				a.download = "test.json";
				a.href = window.URL.createObjectURL(blob);
				a.dataset.downloadurl = ['text/json', a.download, a.href].join(':');
				e.initEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
				a.dispatchEvent(e);
				},
			addProd() {
				this.produtos.push({ cod: this.cod, descri: this.descri, preco: this.preco });
				this.cod = '';
				this.descri = '';
				this.preco = '';
				// Ordena
				this.produtos.sort(function (obj1, obj2) {
					return obj1.cod < obj2.cod ? -1 :(obj1.cod > obj2.cod ? 1 : 0);
					});
				},
			delProd(idx) {
				this.produtos.splice(idx, 1);
				},
			edtProd(idx) {
				this.cod = this.produtos[idx].cod;
				this.descri = this.produtos[idx].descri;
				this.preco = this.produtos[idx].preco;
				this.delProd(idx);
				}
			},
		computed: {
			frmOk: function() {
				return this.cod && this.descri && this.preco;
				},
			temProd: function(){
				return ( this.produtos.length > 0 );
				}
			}
	  })
		
	function init(){
		vm = app.mount('#app')
		}
  </script>
</head>
<body onload="init();">

<h1>Vue 3 Exemplo</h1>
<p>Formulário de dados imediatos. Salvando registros.</p>

<div id="app">
	<h1>Produtos</h1>
	<button @click="saveReg">SALVA</button><button @click="loadReg">CARREGA</button>
	<!-- button @click="onclick" v-else>Muda para PF</button><br -->
	<!-- Painel de Controle -->
	<label>CONTROLE:</label>{{ cod }} | {{ descri }} | {{ preco }} <label>Condição:</label>{{ frmOk }}
	<br>
	<form name="frm1" @submit.prevent="addProd">
		<!-- Introdução do v-model -->
		<label>Código:<input name="Cod" v-model="cod" /><br>
		<label>Descrição:<input name="Descri" v-model="descri" /><br>
		<label>Preço:<input name="Preco" v-model="preco" /><br>
		<input type="submit" v-if="frmOk" value="GRAVAR">
	</form>
	<p>&nbsp;</p>
	<table>
		<tr v-if="temProd"><th>No.</th><th>Código</th><th>Descrição</th><th>Preço (R$)</th></tr>
		<tr v-for="(item,k) in produtos" :key="item.cod">
			<td>{{ k }}</td><td>{{ item.cod }}</td><td>{{ item.descri }}</td><td>{{ item.preco }}</td>
			<td class="fte18 vd">&#128065;</td><td class="fte16" @click="edtProd(k)">&#9997;</td><td class="fte16 mr neg" @click="delProd(k)">&#128465;</td>
		</tr>
	</table>

</div>

</body>
</html>